(()=>{var e,o,n={},i={};function t(e){var o=i[e];if(void 0!==o)return o.exports;var r=i[e]={exports:{}};return n[e](r,r.exports,t),r.exports}t.m=n,t.d=(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce((o,n)=>(t.f[n](e,o),o),[])),t.u=e=>e+".js",t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),e={},o="looker-kpi-tile-vis:",t.l=(n,i,r,a)=>{if(e[n])e[n].push(i);else{var l,s;if(void 0!==r)for(var p=document.getElementsByTagName("script"),c=0;c<p.length;c++){var d=p[c];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==o+r){l=d;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,t.nc&&l.setAttribute("nonce",t.nc),l.setAttribute("data-webpack",o+r),l.src=n),e[n]=[i];var u=(o,i)=>{l.onerror=l.onload=null,clearTimeout(f);var t=e[n];if(delete e[n],l.parentNode&&l.parentNode.removeChild(l),t&&t.forEach(e=>e(i)),o)return o(i)},f=setTimeout(u.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=u.bind(null,l.onerror),l.onload=u.bind(null,l.onload),s&&document.head.appendChild(l)}},t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var o=t.g.document;if(!e&&o&&(o.currentScript&&"SCRIPT"===o.currentScript.tagName.toUpperCase()&&(e=o.currentScript.src),!e)){var n=o.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),(()=>{var e={942:0};t.f.j=(o,n)=>{var i=t.o(e,o)?e[o]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((n,t)=>i=e[o]=[n,t]);n.push(i[2]=r);var a=t.p+t.u(o),l=new Error;t.l(a,n=>{if(t.o(e,o)&&(0!==(i=e[o])&&(e[o]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;l.message="Loading chunk "+o+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,i[1](l)}},"chunk-"+o,o)}};var o=(o,n)=>{var i,r,[a,l,s]=n,p=0;if(a.some(o=>0!==e[o])){for(i in l)t.o(l,i)&&(t.m[i]=l[i]);s&&s(t)}for(o&&o(n);p<a.length;p++)r=a[p],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunklooker_kpi_tile_vis=self.webpackChunklooker_kpi_tile_vis||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))})(),looker.plugins.visualizations.add({options:{title:{type:"string",label:"Title",placeholder:"My KPI"},kpiValueSize:{type:"number",label:"KPI Value Font Size",default:48},kpiValueColor:{type:"string",label:"KPI Value Color",display:"color",default:"#212121"},showTooltip:{type:"boolean",label:"Show Description Icon",default:!0,section:"Tooltip"},comparisonType:{type:"string",label:"Comparison Type",values:[{Percentage:"Percentage"},{Raw:"Raw"}],default:"Percentage",display:"radio",section:"Comparisons"},showComparison1:{type:"boolean",label:"Show First Comparison",default:!0,section:"Comparisons"},comparison1Label:{type:"string",label:"First Comparison Label",placeholder:"vs. Previous Period",section:"Comparisons"},showComparison2:{type:"boolean",label:"Show Second Comparison",default:!1,section:"Comparisons"},comparison2Label:{type:"string",label:"Second Comparison Label",placeholder:"vs. Target",section:"Comparisons"},comparisonColorPositive:{type:"string",label:"Comparison Color (Positive)",display:"color",default:"#4CAF50",section:"Comparisons"},comparisonColorNegative:{type:"string",label:"Comparison Color (Negative)",display:"color",default:"#F44336",section:"Comparisons"},show_line_chart:{type:"boolean",label:"Show Line Chart",default:!0,section:"Chart"},line_chart_color:{type:"string",label:"Line Chart Color",display:"color",default:"#1A73E8",section:"Chart"},goal:{type:"number",label:"Goal",section:"Goal"},show_goal_progress:{type:"boolean",label:"Show Goal Progress",default:!0,section:"Goal"},progress_bar_color:{type:"string",label:"Progress Bar Color",display:"color",default:"#1A73E8",section:"Goal"}},create:function(e,o){e.innerHTML='\n      <style>\n        .kpi-tile-container {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n          height: 100%;\n          font-family: \'Google Sans\', \'Noto Sans\', \'Noto Sans JP\', \'Noto Sans CJK KR\', \'Noto Sans Arabic UI\', \'Noto Sans Devanagari UI\', \'Noto Sans Hebrew UI\', \'Noto Sans Thai UI\', \'Helvetica\', \'Arial\', sans-serif;\n          text-align: center;\n          padding: 20px;\n          box-sizing: border-box;\n        }\n        .kpi-title-container {\n          display: flex;\n          flex-direction: row;\n          justify-content: center;\n          align-items: center;\n          position: relative;\n          margin-top: 5px;\n        }\n        .kpi-title {\n          font-size: 12px;\n          color: #616161;\n          font-weight: bold;\n          margin-right: 8px;\n        }\n        .kpi-info-icon {\n          font-family: \'Serif\';\n          font-style: italic;\n          font-weight: bold;\n          font-size: 10px;\n          color: #fff;\n          background-color: #a8a8a8;\n          border-radius: 50%;\n          width: 14px;\n          height: 14px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          cursor: pointer;\n          user-select: none;\n        }\n        .kpi-tooltip {\n            visibility: hidden;\n            width: 180px;\n            background-color: #333;\n            color: #fff;\n            text-align: left;\n            border-radius: 6px;\n            padding: 10px;\n            position: absolute;\n            z-index: 10;\n            bottom: 150%;\n            left: 50%;\n            margin-left: -90px;\n            opacity: 0;\n            transition: opacity 0.3s, visibility 0.3s;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n        }\n        .kpi-tooltip.visible {\n            visibility: visible;\n            opacity: 1;\n        }\n        .kpi-tooltip-content {\n            font-size: 12px;\n        }\n        .kpi-tooltip-close {\n            position: absolute;\n            top: 2px;\n            right: 8px;\n            font-size: 22px;\n            font-weight: bold;\n            cursor: pointer;\n            color: #ccc;\n        }\n        .kpi-tooltip-close:hover {\n            color: #fff;\n        }\n        .kpi-value {\n          font-weight: bold;\n          line-height: 1;\n          margin-top: 5px;\n        }\n        .kpi-comparison-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            margin-top: 5px;\n        }\n        .kpi-comparison {\n          font-size: 14px;\n          font-weight: 500;\n          margin-top: 5px;\n        }\n        .kpi-chart-container {\n          width: 100%;\n          height: 60px;\n          margin-top: 10px;\n        }\n        .progress-bar-container {\n          width: 80%;\n          height: 8px;\n          background-color: #e0e0e0;\n          border-radius: 4px;\n          margin-top: 10px;\n        }\n        .progress-bar {\n          height: 100%;\n          border-radius: 4px;\n        }\n      </style>\n      <div class="kpi-tile-container">\n        <div class="kpi-value"></div>\n        <div class="kpi-title-container">\n            <div class="kpi-title"></div>\n            <div class="kpi-info-icon">i</div>\n            <div class="kpi-tooltip">\n                <span class="kpi-tooltip-close">&times;</span>\n                <div class="kpi-tooltip-content"></div>\n            </div>\n        </div>\n        <div class="kpi-comparison-container">\n            <div class="kpi-comparison" id="kpi-comparison-1"></div>\n            <div class="kpi-comparison" id="kpi-comparison-2"></div>\n        </div>\n        <div class="kpi-chart-container">\n          <canvas id="kpi-chart"></canvas>\n        </div>\n        <div class="progress-bar-container">\n          <div class="progress-bar"></div>\n        </div>\n      </div>\n    ';var n=e.querySelector(".kpi-info-icon"),i=e.querySelector(".kpi-tooltip"),t=e.querySelector(".kpi-tooltip-close");n.onclick=function(){i.classList.toggle("visible")},t.onclick=function(){i.classList.remove("visible")}},updateAsync:function(e,o,n,i,r,a){var l=this;if(this.clearErrors(),i.fields.measures.length<1)this.addError({title:"No Measures",message:"This visualization requires at least one measure."});else{var s=e[0];if(s){var p=i.fields.measures[0],c=s[p.name],d=LookerCharts.Utils.textForCell(c),u=o.querySelector(".kpi-title"),f=o.querySelector(".kpi-tooltip"),v=o.querySelector(".kpi-tooltip-content"),b=o.querySelector(".kpi-info-icon"),y=o.querySelector(".kpi-value"),m=o.querySelector("#kpi-comparison-1"),g=o.querySelector("#kpi-comparison-2"),h=o.querySelector(".kpi-chart-container"),k=o.querySelector(".progress-bar-container"),x=o.querySelector(".progress-bar");if(u.textContent=n.title||p.label_short||p.label,n.showTooltip&&p.description?(v.textContent=p.description,b.style.display="flex"):(b.style.display="none",f.classList.remove("visible")),y.textContent=d,y.style.color=n.kpiValueColor,y.style.fontSize="".concat(n.kpiValueSize,"px"),m.style.display="none",g.style.display="none",h.style.display="none",k.style.display="none",n.showComparison1&&i.fields.measures.length>1){var C=s[i.fields.measures[1].name];if("number"==typeof c.value&&"number"==typeof C.value&&0!==C.value){var w,S=c.value,_=C.value,P=S-_,T=P>=0,N=T?"▲":"▼";w="Raw"===n.comparisonType?P.toFixed(1):(P/Math.abs(_)*100).toFixed(1)+"%",m.textContent="".concat(N," ").concat(w," ").concat(n.comparison1Label||"vs. Previous Period"),m.style.color=T?n.comparisonColorPositive:n.comparisonColorNegative,m.style.display="block"}}if(n.showComparison2&&i.fields.measures.length>2){var q=s[i.fields.measures[2].name];if("number"==typeof c.value&&"number"==typeof q.value&&0!==q.value){var L,z=c.value,j=q.value,A=z-j,E=A>=0,F=E?"▲":"▼";L="Raw"===n.comparisonType?A.toFixed(1):(A/Math.abs(j)*100).toFixed(1)+"%",g.textContent="".concat(F," ").concat(L," ").concat(n.comparison2Label||"vs. Target"),g.style.color=E?n.comparisonColorPositive:n.comparisonColorNegative,g.style.display="block"}}if(n.show_line_chart&&i.fields.dimensions.length>0&&(h.style.display="block",t.e(349).then(t.bind(t,349)).then(function(t){var r=i.fields.dimensions[0],a=e.map(function(e){return e[r.name].value}),s=e.map(function(e){return e[p.name].value}),c=o.querySelector("#kpi-chart").getContext("2d");l._chart&&l._chart.destroy(),l._chart=new t.default(c,{type:"line",data:{labels:a,datasets:[{data:s,borderColor:n.line_chart_color,borderWidth:2,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1},y:{display:!1}}}})})),n.show_goal_progress&&n.goal){k.style.display="block";var I=c.value/n.goal*100;x.style.width="".concat(Math.min(I,100),"%"),x.style.backgroundColor=n.progress_bar_color}a()}else a()}}})})();